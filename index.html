<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIP Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Inter', Arial, sans-serif; /* Using Inter for better aesthetics */
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navigation-buttons {
            text-align: center;
            margin-bottom: 20px;
        }
        .navigation-buttons button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: background-color 0.3s ease;
        }
        .navigation-buttons button:hover {
            background: #0056b3;
        }
        .input-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
        }
        .input-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .input-item {
            flex: 1;
            min-width: 200px;
        }
        .input-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-item input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        .calculate-btn {
            background: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: background-color 0.3s ease; /* Smooth transition */
        }
        .calculate-btn:hover {
            background: #218838;
        }
        .pdf-btn {
            background: #dc3545;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease; /* Smooth transition */
        }
        .pdf-btn:hover {
            background: #c82333;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .summary-item {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* Subtle shadow */
        }
        .summary-item.pay {
            background: #87CEEB; /* Light Blue */
            color: #000;
        }
        .summary-item.total-paid {
            background: #90EE90; /* Light Green */
            color: #000;
        }
        .summary-item.monthly-receive {
            background: #FF69B4; /* Hot Pink */
            color: white;
        }
        .summary-item.final-amount {
            background: #FFD700; /* Gold */
            color: #000;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            min-width: 700px; /* Ensure table doesn't get too narrow on small screens */
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .outflow {
            color: #dc3545;
            font-weight: bold;
        }
        .inflow {
            color: #28a745;
            font-weight: bold;
        }
        .final-row {
            background-color: #e3f2fd;
            font-weight: bold;
        }
        .total-row {
            background-color: #fff3cd;
            font-weight: bold;
        }
        .inflow-option-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        .inflow-option-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
            cursor: pointer;
        }
        .inflow-option-group input[type="radio"] {
            width: auto;
            margin: 0;
        }
        /* New styles for fund recommendations section */
        .fund-recommendations {
            margin-top: 40px;
            padding: 20px;
            background-color: #e6f7ff; /* Light blue background */
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .fund-recommendations h2 {
            text-align: center;
            color: #0056b3;
            margin-bottom: 25px;
        }
        .fund-category {
            margin-bottom: 30px;
        }
        .fund-category h3 {
            color: #0056b3;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .fund-category-table {
            overflow-x: auto;
        }
        .fund-category-table table {
            font-size: 11px;
            width: 100%;
            min-width: 500px; /* Ensure tables don't get too narrow */
        }
        .fund-category-table th {
            background-color: #add8e6; /* Light blue for headers */
            color: #333;
        }
        .disclaimer {
            font-size: 12px;
            color: #666;
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Replaced "SIP Calculator" with "masterSchetan.com" and added a hyperlink -->
        <h1 style="text-align: center; color: #333; margin-bottom: 30px;">
            <a href="https://masterschetan.com/" target="_blank" style="text-decoration: none; color: inherit;">master<span style="color: red;">S</span>chetan.com</a>
        </h1>
        
        <div class="navigation-buttons">
            <button onclick="showPage('sipCalculatorContent')">Go to SIP Calculator</button>
            <button onclick="showPage('fundRecommendationsPage')">Go to Fund Recommendations</button>
        </div>

        <div id="sipCalculatorContent">
            <div class="input-section">
                <div class="input-group">
                    <div class="input-item">
                        <label for="monthlyPayment">Monthly Payment (Rs.)</label>
                        <input type="number" id="monthlyPayment" value="100000" min="100">
                    </div>
                    <div class="input-item">
                        <label for="years">Investment Period (Years)</label>
                        <input type="number" id="years" value="8" min="1">
                    </div>
                    <div class="input-item">
                        <label for="monthlyReceive">Monthly Receive (Rs.)</label>
                        <input type="number" id="monthlyReceive" value="100000" min="100">
                    </div>
                    <div class="input-item">
                        <label for="returnRate">Return Rate (%)</label>
                        <input type="number" id="returnRate" value="15" min="1" max="50" step="0.1">
                    </div>
                </div>
                <div class="inflow-option-group">
                    <label>
                        <input type="radio" name="inflowType" value="constant" checked>
                        Constant Monthly Inflow
                    </label>
                    <label>
                        <input type="radio" name="inflowType" value="doubling">
                        Inflow with 1-2-3-4 Pattern (based on Investment Period)
                    </label>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="calculate-btn" onclick="calculateSIP()">Calculate SIP</button>
                    <button class="pdf-btn" onclick="downloadReport()">Download Report</button>
                </div>
            </div>

            <div class="summary" id="summary" style="display: none;">
                <div class="summary-item pay">
                    <div>Monthly Payment</div>
                    <div id="summaryPay">Rs. 1,000</div>
                </div>
                <div class="summary-item total-paid">
                    <div>Total Amount Paid (96 Months)</div>
                    <div id="summaryTotalPaid">Rs. 96,000</div>
                </div>
                <div class="summary-item monthly-receive">
                    <div>Monthly Receive (97 Months onwards)</div>
                    <div id="summaryMonthlyReceive">Rs. 1,000</div>
                </div>
                <div class="summary-item final-amount">
                    <div>Final Amount</div>
                    <div id="summaryFinalAmount">Rs. 1,00,46,254.49</div>
                </div>
            </div>

            <div class="table-container" id="tableContainer" style="display: none;">
                <table id="sipTable">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Opening</th>
                            <th>Outflow</th>
                            <th>Total</th>
                            <th>Avg Return</th>
                            <th>Total + Return</th>
                            <th>Inflow</th>
                            <th>Closing Balance</th>
                        </tr>
                    </thead>
                    <tbody id="sipTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- New section for Mutual Fund Recommendations - now a separate page -->
        <div id="fundRecommendationsPage" class="fund-recommendations" style="display: none;">
            <h2>Mutual Fund Recommendations (Data from Provided Document)</h2>
            <p class="disclaimer">
                <strong>Disclaimer:</strong> The fund data below is extracted from the provided Word document and is static as of March 21, 2025. It is NOT live data. For the most accurate and up-to-date fund information, please visit the respective fund house websites or financial advisors. This is not financial advice.
            </p>

            <div id="fundRecommendationsContainer">
                <!-- Fund categories and tables will be rendered here by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        let calculationData = [];
        let overallTotalInflow = 0; 
        
        // This data is now pre-populated from the provided Word document with updated hyperlinks
        const mutualFundData = {
            "Small Cap Funds": [
                {"name": "Bandhan Small Cap", "cagr": "33.96% (Since Inception)", "launchDate": "08-02-2020", "url": "https://www.advisorkhoj.com/mutual-funds-research/BANDHAN-SMALL-CAP-FUND-REGULAR-PLAN-GROWTH"},
                {"name": "Mahindra Manulife Small Cap", "cagr": "30.01% (Since Inception)", "launchDate": "05-12-2022", "url": "https://www.advisorkhoj.com/mutual-funds-research/Mahindra-Manulife-Small-Cap-Fund-Regular-Plan-Growth"},
                {"name": "Bank of India Small", "cagr": "27.26% (Since Inception)", "launchDate": "12-12-2018", "url": "https://www.advisorkhoj.com/mutual-funds-research/BANK-OF-INDIA-Small-Cap-Fund-Regular-Plan-Growth"}
            ],
            "Mid Cap Funds": [
                {"name": "Union MidCap", "cagr": "33.51% (Since Inception)", "launchDate": "23-03-2020", "url": "https://www.advisorkhoj.com/mutual-funds-research/Union-Midcap-Fund-Regular-Plan-Growth-Option"},
                {"name": "JM Midcap", "cagr": "28.76% (Since Inception)", "launchDate": "21-11-2022", "url": "https://www.advisorkhoj.com/mutual-funds-research/JM-Midcap-Fund-Regular-Growth"},
                {"name": "WhiteOak Capital Mid Cap", "cagr": "25.79% (Since Inception)", "launchDate": "25-06-2007", "url": "https://www.advisorkhoj.com/mutual-funds-research/WhiteOak-Capital-Mid-Cap-Fund-Regular-Plan-Growth"}
            ],
            "Large Cap Funds": [
                {"name": "Motilal Oswal Large Cap", "cagr": "27.95% (Since Inception)", "launchDate": "06-02-2024", "url": "https://www.advisorkhoj.com/mutual-funds-research/Motilal-Oswal-Large-Cap-Regular-Plan-Growth"},
                {"name": "ABSL Large Cap", "cagr": "18.94% (Since Inception)", "launchDate": "05-08-2002", "url": "https://www.advisorkhoj.com/mutual-funds-research/Aditya-Birla-Sun-Life-Large-Cap-Fund-Growth"},
                {"name": "DSP Large Cap", "cagr": "18.87% (Since Inception)", "launchDate": "05-03-2003", "url": "https://www.advisorkhoj.com/mutual-funds-research/DSP-Large-Cap-Fund-Regular-Plan-Growth"}
            ],
            "Flexi Cap Funds": [
                {"name": "Bank of India Flexi Cap", "cagr": "28.18% (Since Inception)", "launchDate": "05-06-2020", "url": "https://www.advisorkhoj.com/mutual-funds-research/BANK-OF-INDIA-Flexi-Cap-Fund-Regular-Plan-Growth"},
                {"name": "ITI Flexi Cap", "cagr": "27.72% (Since Inception)", "launchDate": "17-02-2023", "url": "https://www.advisorkhoj.com/mutual-funds-research/ITI-Flexi-Cap-Fund-Regular-Plan-Growth"},
                {"name": "Helios Flexi Cap", "cagr": "23.38% (Since Inception)", "launchDate": "13-11-2023", "url": "https://www.advisorkhoj.com/mutual-funds-research/Helios-Flexi-Cap-Fund-Regular-Plan-Growth-Option"}
            ]
        };

        // Function to switch between pages
        function showPage(pageId) {
            document.getElementById('sipCalculatorContent').style.display = 'none';
            document.getElementById('fundRecommendationsPage').style.display = 'none';
            document.getElementById(pageId).style.display = 'block';
        }

        function calculateSIP() {
            try {
                const monthlyPayment = parseFloat(document.getElementById('monthlyPayment').value);
                const years = parseInt(document.getElementById('years').value);
                const monthlyReceive = parseFloat(document.getElementById('monthlyReceive').value);
                const returnRate = parseFloat(document.getElementById('returnRate').value) / 100;
                const inflowType = document.querySelector('input[name="inflowType"]:checked').value; 
                
                calculationData = [];
                let totalPaid = 0;
                let previousBalance = 0;
                overallTotalInflow = 0; 
                
                const tbody = document.getElementById('sipTableBody');
                tbody.innerHTML = '';
                
                // Calculate for investment period (outflow years)
                for (let year = 1; year <= years; year++) {
                    const yearlyOutflow = monthlyPayment * 12;
                    totalPaid += yearlyOutflow;
                    
                    const opening = previousBalance;
                    const total = opening + yearlyOutflow;
                    const avgReturn = total * returnRate;
                    const totalWithReturn = total + avgReturn;
                    const inflow = 0;
                    const closingBalance = totalWithReturn - inflow;
                    
                    calculationData.push({
                        year: year,
                        opening: opening,
                        outflow: yearlyOutflow, 
                        total: total,
                        avgReturn: avgReturn,
                        totalWithReturn: totalWithReturn,
                        inflow: inflow,
                        closingBalance: closingBalance
                    });
                    
                    previousBalance = closingBalance;
                }
                
                // Calculate for receiving period (inflow years) - up to 40 years total
                let receiveYear = years + 1;
                const maxYears = 40; 
                
                while (receiveYear <= maxYears && previousBalance > 0) {
                    const opening = previousBalance;
                    const outflow = 0; 
                    const total = opening + outflow;
                    const avgReturn = total * returnRate;
                    const totalWithReturn = total + avgReturn;
                    
                    let currentYearlyInflow = 0;
                    if (inflowType === 'constant') {
                        currentYearlyInflow = monthlyReceive * 12;
                    } else if (inflowType === 'doubling') {
                        const yearsInReceivingPhase = receiveYear - years; 
                        const periodIndex = Math.ceil(yearsInReceivingPhase / years);
                        currentYearlyInflow = (monthlyReceive * 12) * periodIndex;
                    }

                    const inflow = currentYearlyInflow;
                    const closingBalance = Math.max(0, totalWithReturn - inflow);
                    
                    overallTotalInflow += inflow; 
                    
                    calculationData.push({
                        year: receiveYear,
                        opening: opening,
                        outflow: outflow,
                        total: total,
                        avgReturn: avgReturn,
                        totalWithReturn: totalWithReturn,
                        inflow: inflow,
                        closingBalance: closingBalance
                    });
                    
                    previousBalance = closingBalance;
                    receiveYear++;
                }
                
                // Update summary
                const finalClosingBalance = calculationData[calculationData.length - 1].closingBalance;
                const finalAmountCalculated = finalClosingBalance + overallTotalInflow; 

                const totalMonths = years * 12;
                
                document.getElementById('summaryPay').textContent = `Rs. ${monthlyPayment.toLocaleString()}`;
                document.getElementById('summaryTotalPaid').innerHTML = `Rs. ${totalPaid.toLocaleString()}<br><small>(${totalMonths} Months)</small>`;
                document.getElementById('summaryMonthlyReceive').innerHTML = `Rs. ${monthlyReceive.toLocaleString()}${inflowType === 'doubling' ? ' (1-2-3-4 Pattern)' : ''}<br><small>(${totalMonths + 1} Months onwards)</small>`;
                document.getElementById('summaryFinalAmount').textContent = `Rs. ${finalAmountCalculated.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Display table
                displayTable();
                
                // Show summary and table
                document.getElementById('summary').style.display = 'grid';
                document.getElementById('tableContainer').style.display = 'block';
            } catch (error) {
                console.error("Error in calculateSIP:", error);
                showMessageBox("An error occurred during calculation. Please check your inputs.");
            }
        }
        
        function displayTable() {
            const tbody = document.getElementById('sipTableBody');
            tbody.innerHTML = '';
            
            calculationData.forEach(data => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${data.year}</td>
                    <td>${data.opening.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td class="${data.outflow > 0 ? 'outflow' : ''}">${data.outflow.toLocaleString('en-IN')}</td>
                    <td>${data.total.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>${data.avgReturn.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td>${data.totalWithReturn.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td class="${data.inflow > 0 ? 'inflow' : ''}">${data.inflow.toLocaleString('en-IN')}</td>
                    <td>${data.closingBalance.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                `;
                
                if (data.year === calculationData[calculationData.length - 1].year) {
                    row.classList.add('final-row');
                }
            });
            
            // Add total row
            const totalRow = tbody.insertRow();
            const totalPaid = calculationData.filter(d => d.outflow > 0).reduce((sum, d) => sum + d.outflow, 0);
            const totalReceived = overallTotalInflow; 
            const finalClosingBalance = calculationData[calculationData.length - 1].closingBalance;
            const finalAmountForTotalRow = finalClosingBalance + totalReceived;
            
            totalRow.classList.add('total-row');
            totalRow.innerHTML = `
                <td colspan="2"><strong>TOTAL</strong></td>
                <td class="outflow"><strong>${totalPaid.toLocaleString('en-IN')}</strong></td>
                <td colspan="3"></td>
                <td class="inflow"><strong>${totalReceived.toLocaleString('en-IN')}</strong></td>
                <td><strong>${finalAmountForTotalRow.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</strong></td>
            `;
        }
        
        async function downloadReport() {
            if (calculationData.length === 0) {
                showMessageBox('Please calculate SIP first!');
                return;
            }

            console.log('Starting PDF generation...');

            const monthlyPayment = document.getElementById('monthlyPayment').value;
            const years = document.getElementById('years').value;
            const monthlyReceive = parseFloat(document.getElementById('monthlyReceive').value);
            const returnRate = parseFloat(document.getElementById('returnRate').value); 
            const inflowType = document.querySelector('input[name="inflowType"]:checked').value;
            
            const finalClosingBalance = calculationData[calculationData.length - 1].closingBalance;
            const finalAmountForPdf = finalClosingBalance + overallTotalInflow; 

            const totalMonths = years * 12;
            const totalPaid = monthlyPayment * totalMonths; 
            
            if (typeof window.jspdf === 'undefined' || typeof html2canvas === 'undefined') {
                console.error('jsPDF or html2canvas not loaded');
                fallbackDownload();
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                let yPos = 20;

                // --- Add SIP Calculator Content to PDF ---
                pdf.setFontSize(20);
                pdf.text('SIP Calculator Report', 105, yPos, { align: 'center' });
                yPos += 10;

                pdf.setFontSize(12);
                pdf.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, yPos, { align: 'center' });
                yPos += 20;

                // Add summary section
                pdf.setFontSize(16);
                pdf.text('Investment Summary', 20, yPos);
                yPos += 15;

                pdf.setFontSize(12);
                pdf.text(`Monthly Payment: Rs. ${parseInt(monthlyPayment).toLocaleString()}`, 20, yPos);
                yPos += 8;
                pdf.text(`Investment Period: ${years} years (${totalMonths} months)`, 20, yPos);
                yPos += 8;
                pdf.text(`Total Amount Paid: Rs. ${totalPaid.toLocaleString()}`, 20, yPos);
                yPos += 8;
                pdf.text(`Monthly Receive: Rs. ${monthlyReceive.toLocaleString()} ${inflowType === 'doubling' ? ' (1-2-3-4 Pattern)' : ''} (from month ${totalMonths + 1})`, 20, yPos);
                yPos += 8;
                pdf.text(`Return Rate: ${returnRate}%`, 20, yPos);
                yPos += 8;
                pdf.text(`Final Amount: Rs. ${finalAmountForPdf.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`, 20, yPos);

                // Add key insights
                yPos += 20;
                pdf.setFontSize(16);
                pdf.text('Key Insights:', 20, yPos);

                pdf.setFontSize(11);
                yPos += 12;
                pdf.text(`• You invest Rs. ${parseInt(monthlyPayment).toLocaleString()} monthly for ${years} years`, 20, yPos);
                yPos += 8;
                pdf.text(`• Total investment: Rs. ${totalPaid.toLocaleString()}`, 20, yPos);
                yPos += 8;
                pdf.text(`• From year ${parseInt(years) + 1}, you receive Rs. ${monthlyReceive.toLocaleString()} ${inflowType === 'doubling' ? ' (1-2-3-4 Pattern)' : ''} monthly`, 20, yPos);
                yPos += 8;
                pdf.text(`• Final amount (Closing Balance + Total Inflow): Rs. ${finalAmountForPdf.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`, 20, yPos);
                yPos += 8;
                pdf.text(`• This plan provides both regular income and wealth preservation`, 20, yPos);
                
                // Add SIP table to PDF
                pdf.addPage();
                yPos = 20;
                pdf.setFontSize(16);
                pdf.text('Year-wise Breakdown', 20, yPos);
                yPos += 10;

                const sipTable = document.getElementById('sipTable');
                const sipCanvas = await html2canvas(sipTable, { scale: 2, logging: false, useCORS: true });
                const sipImgData = sipCanvas.toDataURL('image/png');
                const sipImgWidth = 190; 
                const pageHeight = pdf.internal.pageSize.height;
                const sipImgHeight = sipCanvas.height * sipImgWidth / sipCanvas.width;
                let sipHeightLeft = sipImgHeight;
                let sipPosition = yPos; 

                pdf.addImage(sipImgData, 'PNG', 10, sipPosition, sipImgWidth, sipImgHeight);
                sipHeightLeft -= (pageHeight - sipPosition);

                while (sipHeightLeft > 0) {
                    pdf.addPage();
                    sipPosition = - (sipImgHeight - sipHeightLeft); 
                    pdf.addImage(sipImgData, 'PNG', 10, sipPosition, sipImgWidth, sipImgHeight);
                    sipHeightLeft -= pageHeight;
                }

                // --- Add Mutual Fund Recommendations to PDF ---
                pdf.addPage();
                yPos = 20;
                pdf.setFontSize(20);
                pdf.text('Mutual Fund Recommendations', 105, yPos, { align: 'center' });
                yPos += 10;
                pdf.setFontSize(10);
                pdf.text('Disclaimer: The fund data below is extracted from the provided Word document and is static as of March 21, 2025. It is NOT live data. For the most accurate and up-to-date fund information, please visit the respective fund house websites or financial advisors. This is not financial advice.', 105, yPos + 5, { align: 'center', maxWidth: 180 });
                yPos += 30; 

                const fundRecommendationsContainer = document.getElementById('fundRecommendationsContainer');
                const fundCategoryDivs = fundRecommendationsContainer.querySelectorAll('.fund-category');
                
                for (const categoryDiv of Array.from(fundCategoryDivs)) {
                    const categoryName = categoryDiv.querySelector('h3').textContent;
                    const tableElement = categoryDiv.querySelector('table');

                    if (yPos + 10 > pdf.internal.pageSize.height - 20) { 
                        pdf.addPage();
                        yPos = 20;
                    }
                    pdf.setFontSize(14);
                    pdf.text(categoryName, 20, yPos);
                    yPos += 10;

                    if (tableElement) {
                        const categoryCanvas = await html2canvas(tableElement, { scale: 2, logging: false, useCORS: true });
                        const categoryImgData = categoryCanvas.toDataURL('image/png');
                        const categoryImgWidth = 180; 
                        const categoryImgHeight = categoryCanvas.height * categoryImgWidth / categoryCanvas.width;

                        if (yPos + categoryImgHeight > pdf.internal.pageSize.height - 20) { 
                            pdf.addPage();
                            yPos = 20;
                        }
                        pdf.addImage(categoryImgData, 'PNG', 15, yPos, categoryImgWidth, categoryImgHeight);
                        yPos += categoryImgHeight + 15; 
                    } else {
                        // Handle case where no table is present (e.g., "No fund data available")
                        pdf.setFontSize(10);
                        pdf.text("No fund data available for this category.", 20, yPos);
                        yPos += 10;
                    }
                }
                
                pdf.save('SIP-Calculator-Report.pdf');
                console.log('PDF generated successfully');

            } catch (error) {
                console.error('Error generating PDF:', error);
                fallbackDownload();
            }
        }
        
        function formatNumber(num) {
            if (num >= 10000000) {
                return (num / 10000000).toFixed(1) + 'Cr';
            } else if (num >= 100000) {
                return (num / 100000).toFixed(1) + 'L';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toFixed(0);
        }
        
        function fallbackDownload() {
            const monthlyPayment = document.getElementById('monthlyPayment').value;
            const years = document.getElementById('years').value;
            const monthlyReceive = parseFloat(document.getElementById('monthlyReceive').value);
            const returnRate = parseFloat(document.getElementById('returnRate').value); 
            const inflowType = document.querySelector('input[name="inflowType"]:checked').value;
            
            const finalClosingBalance = calculationData[calculationData.length - 1].closingBalance;
            const finalAmountForHtml = finalClosingBalance + overallTotalInflow; 
            
            const totalMonths = years * 12;
            const totalPaid = monthlyPayment * totalMonths;
            
            // Create HTML report as fallback
            let htmlReport = `
<!DOCTYPE html>
<html>
<head>
    <title>SIP Calculator Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .header { text-align: center; color: #333; margin-bottom: 30px; }
        .summary { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .insights { background: #e8f5e8; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; font-size: 12px; }
        th { background-color: #3498db; color: white; font-weight: bold; }
        .outflow { color: #e74c3c; font-weight: bold; }
        .inflow { color: #27ae60; font-weight: bold; }
        .print-btn { margin: 20px 0; padding: 10px 20px; background: #3498db; color: white; border: none; cursor: pointer; }
        @media print { .print-btn { display: none; } }
        .disclaimer { font-size: 10px; color: #666; margin-top: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; background-color: #f9f9f9; }
    </style>
</head>
<body>
    <div class="header">
        <h1>SIP Calculator Report</h1>
        <p>Generated on: ${new Date().toLocaleDateString()}</p>
    </div>
    
    <div class="summary">
        <h2>Investment Summary</h2>
        <div class="summary-grid">
            <div><strong>Monthly Payment:</strong> Rs. ${parseInt(monthlyPayment).toLocaleString()}</div>
            <div><strong>Investment Period:</strong> ${years} years (${totalMonths} months)</div>
            <div><strong>Total Amount Paid:</strong> Rs. ${totalPaid.toLocaleString()}</div>
            <div><strong>Monthly Receive:</strong> Rs. ${monthlyReceive.toLocaleString()}</div>
            <div><strong>Return Rate:</strong> ${returnRate}%</div>
            <div><strong>Final Amount:</strong> Rs. ${finalAmountForHtml.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
        </div>
    </div>
    
    <div class="insights">
        <h3>Key Insights:</h3>
        <ul>
            <li>You invest Rs. ${parseInt(monthlyPayment).toLocaleString()} monthly for ${years} years</li>
            <li>Total investment: Rs. ${totalPaid.toLocaleString()}</li>
            <li>From year ${parseInt(years) + 1}, you receive Rs. ${monthlyReceive.toLocaleString()} ${inflowType === 'doubling' ? ' (1-2-3-4 Pattern)' : ''} monthly</li>
            <li>Final amount (Closing Balance + Total Inflow): Rs. ${finalAmountForHtml.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</li>
            <li>This plan provides both regular income and wealth preservation</li>
        </ul>
    </div>
    
    <button class="print-btn" onclick="window.print()">Print Report (Ctrl+P)</button>
    
    <h2>Year-wise Breakdown</h2>
    <table>
        <thead>
            <tr>
                <th>Year</th>
                <th>Opening Balance</th>
                <th>Outflow</th>
                <th>Total</th>
                <th>Average Return</th>
                <th>Total + Return</th>
                <th>Inflow</th>
                <th>Closing Balance</th>
            </tr>
        </thead>
        <tbody>`;
            
            calculationData.forEach(data => {
                htmlReport += `
            <tr>
                <td>${data.year}</td>
                <td>Rs. ${data.opening.toLocaleString('en-IN', {maximumFractionDigits: 0})}</td>
                <td class="${data.outflow > 0 ? 'outflow' : ''}">Rs. ${data.outflow.toLocaleString('en-IN')}</td>
                <td>Rs. ${data.total.toLocaleString('en-IN', {maximumFractionDigits: 0})}</td>
                <td>Rs. ${data.avgReturn.toLocaleString('en-IN', {maximumFractionDigits: 0})}</td>
                <td>Rs. ${data.totalWithReturn.toLocaleString('en-IN', {maximumFractionDigits: 0})}</td>
                <td class="${data.inflow > 0 ? 'inflow' : ''}">Rs. ${data.inflow.toLocaleString('en-IN')}</td>
                <td>Rs. ${data.closingBalance.toLocaleString('en-IN', {maximumFractionDigits: 0})}</td>
            </tr>`;
            });
            
            htmlReport += `
        </tbody>
    </table>

    <!-- Fund Recommendations for HTML fallback -->
    <h2>Mutual Fund Recommendations (Sample Data)</h2>
    <p class="disclaimer">
        <strong>Disclaimer:</strong> The fund data below is extracted from the provided Word document and is static as of March 21, 2025. It is NOT live data. For the most accurate and up-to-date fund information, please visit the respective fund house websites or financial advisors. This is not financial advice.
    </p>
    `;

            // Add fund tables to HTML report
            for (const category in mutualFundData) {
                htmlReport += `<h3>${category}</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Sr. No.</th>
                            <th>Fund Name</th>
                            <th>CAGR Since Inception</th>
                            <th>Launch Date</th>
                        </tr>
                    </thead>
                    <tbody>`;
                mutualFundData[category].forEach((fund, index) => {
                    htmlReport += `
                        <tr>
                            <td>${index + 1}</td>
                            <td><a href="${fund.url}" target="_blank">${fund.name}</a></td>
                            <td>${fund.cagr}</td>
                            <td>${fund.launchDate}</td>
                        </tr>`;
                });
                htmlReport += `</tbody></table>`;
            }

            htmlReport += `
</body>
</html>`;
            
            // Create and download HTML file
            const blob = new Blob([htmlReport], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'SIP-Calculator-Report.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessageBox('PDF generation failed. Report downloaded as HTML! Open the file and use Ctrl+P to print or save as PDF.');
        }

        // Custom message box function to replace alert()
        function showMessageBox(message) {
            const messageBox = document.createElement('div');
            messageBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #fff;
                border: 1px solid #ccc;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                padding: 20px;
                border-radius: 8px;
                z-index: 1000;
                text-align: center;
                font-family: Arial, sans-serif;
                max-width: 80%;
            `;
            messageBox.innerHTML = `
                <p>${message}</p>
                <button style="
                    background-color: #007bff;
                    color: white;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 5px;
                    cursor: pointer;
                    margin-top: 15px;
                ">OK</button>
            `;
            document.body.appendChild(messageBox);

            messageBox.querySelector('button').onclick = () => {
                document.body.removeChild(messageBox);
            };
        }

        // Function to display fund recommendations on the page
        function displayFundRecommendations() {
            const container = document.getElementById('fundRecommendationsContainer');
            container.innerHTML = ''; // Clear previous content

            // Order of categories as they appear in the Word document
            const orderedCategories = [
                "Small Cap Funds",
                "Mid Cap Funds",
                "Large Cap Funds",
                "Flexi Cap Funds"
            ];

            orderedCategories.forEach(category => {
                if (mutualFundData[category] && mutualFundData[category].length > 0) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.classList.add('fund-category');
                    categoryDiv.innerHTML = `<h3>${category}</h3><div class="fund-category-table"><table>
                        <thead>
                            <tr>
                                <th>Sr. No.</th>
                                <th>Fund Name</th>
                                <th>CAGR Since Inception</th>
                                <th>Launch Date</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table></div>`;
                    
                    const tbody = categoryDiv.querySelector('tbody');
                    mutualFundData[category].forEach((fund, index) => {
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td><a href="${fund.url}" target="_blank">${fund.name}</a></td>
                            <td>${fund.cagr}</td>
                            <td>${fund.launchDate}</td>
                        `;
                    });
                    container.appendChild(categoryDiv);
                } else {
                    console.warn(`No data to display for category: ${category}`);
                    // Optionally, add a row indicating no data
                    const categoryDiv = document.createElement('div');
                    categoryDiv.classList.add('fund-category');
                    categoryDiv.innerHTML = `<h3>${category}</h3><p>No fund data available for this category.</p>`;
                    container.appendChild(categoryDiv);
                }
            });
        }
        
        // Initialize with default calculation and display fund recommendations
        try {
            calculateSIP();
            displayFundRecommendations(); 
            // Show the SIP calculator content by default when the page loads
            showPage('sipCalculatorContent');
        } catch (error) {
            console.error("Initial script execution error:", error);
            showMessageBox("An error occurred during initial page load. Please try refreshing.");
        }
    </script>
</body>
</html>
